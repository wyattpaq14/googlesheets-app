<!DOCTYPE html>
<html>

<head>
  <title>Google Sheets API Quickstart</title>
  <meta charset='utf-8' />
</head>

<body>
  <p>Google Sheets API Quickstart</p>

  <!--Add buttons to initiate auth sequence and sign out-->
  <button id="authorize-button" style="display: none;">Authorize</button>
  <button id="signout-button" style="display: none;">Sign Out</button>

  <pre id="content"></pre>
  <table class="table" id="timesheetinfo">
  </table>

  <script type="text/javascript">

    // get table from body to display timesheet info
    var table = document.getElementById('timesheetinfo')


    // Client ID and API key from the Developer Console
    var CLIENT_ID = '232719789207-s9d4vrksf1o1bht5m3g74e368ijqabka.apps.googleusercontent.com';
    var CLIENT_SECRET = 'l8XHUmDrK4rwvbEzEF51jeMr';
    var API_KEY = 'AIzaSyCBjhCoUlUkNW9Ow7PjMI8AKxIfDjIuEgs';

    // Array of API discovery doc URLs for APIs used by the quickstart
    var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

    // Authorization scopes required by the API; multiple scopes can be
    // included, separated by spaces.
    var SCOPES = "https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/plus.login";

    var authorizeButton = document.getElementById('authorize-button');
    var signoutButton = document.getElementById('signout-button');

    /**
     *  On load, called to load the auth2 library and API client library.
     */
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    /**
     *  Initializes the API client library and sets up sign-in state
     *  listeners.
     */
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(function () {
        // Listen for sign-in state changes.
        gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

        // Handle the initial sign-in state.
        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
        authorizeButton.onclick = handleAuthClick;
        signoutButton.onclick = handleSignoutClick;
      });
    }

    /**
     *  Called when the signed in status changes, to update the UI
     *  appropriately. After a sign-in, the API is called.
     */


    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'block';
        listMajors();
      } else {
        authorizeButton.style.display = 'block';
        signoutButton.style.display = 'none';
      }
    }

    /**
     *  Sign in the user upon button click.
     */
    function handleAuthClick(event) {
      gapi.auth2.getAuthInstance().signIn();
    }

    /**
     *  Sign out the user upon button click.
     */
    function handleSignoutClick(event) {
      gapi.auth2.getAuthInstance().signOut();
    }

    /**
     * Append a pre element to the body containing the given message
     * as its text node. Used to display the results of the API call.
     *
     * @param {string} message Text to be placed in pre element.
     */
    function appendPre(message) {
      var pre = document.getElementById('content');
      var textContent = document.createTextNode(message + '\n');
      pre.appendChild(textContent);
    }

    /**
     * Print the names and majors of students in a sample spreadsheet:
     * https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
      * example: 1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms
      * mine: 19hDuT7T45AJSqKORvPC2HESIh7tOzI7MQ8lV2i0DB0E
     */
    function listMajors() {

      gapi.client.plus.people.get({
        'userId': 'me'
      }).then(function (response) {
        console.log(response)
      });

      gapi.client.sheets.spreadsheets.values.get({
        spreadsheetId: '19hDuT7T45AJSqKORvPC2HESIh7tOzI7MQ8lV2i0DB0E',
        range: 'A3:I',
      }).then(function (response) {
        var range = response.result;
        if (range.values.length > 0) {
          //appendPre('Name, Major:');
          // Create header row
          appendRow(table, ['Week', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Total Hours'], 'th')

          for (i = 0; i < range.values.length; i++) {
            var row = range.values[i];
            // Print columns A and E, which correspond to indices 0 and 4.
            //appendPre(row[0] + ', ' + row[4]);
            //appendPre(row[0] + ', ' + row[1] + ', ' + row[2] + ', ' + row[3] + ', ' + row[4] + ', ' + row[5] + ', ' + row[6] + ', ' + row[7]);
            appendRow(table, [row[0], row[1], row[2], row[3], row[4], row[5], row[6], row[7], row[8]])
          }
        } else {
          appendPre('No data found.');
        }
      }, function (response) {
        appendPre('Error: ' + response.result.error.message);
      });
    }


    function appendRow(table, elements, tag) {
      var row = document.createElement('tr')
      elements.forEach(function (e) {
        var cell = document.createElement(tag || 'td')
        if (typeof e === 'string') {
          cell.textContent = e
        } else {
          cell.appendChild(e)
        }
        row.appendChild(cell)
      })
      table.appendChild(row)
    }

  </script>

  <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</body>

</html>